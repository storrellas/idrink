{% load staticfiles %}
<!DOCTYPE html>
<html><head>
        <meta charset="utf-8">
        <title>iDrink</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Loading Bootstrap -->
        <link href="{% static 'css/bootstrap.css' %}" rel="stylesheet">

        <!-- Edit CSS -->
        <link href="{% static 'css/default.css' %}" rel="stylesheet">
        <link href="{% static 'css/main.css' %}" rel="stylesheet">

        <!-- Font Awesome -->
        <link href="{% static 'css/font-awesome.css' %}" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Titillium+Web:400,900,700,600,300,200" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:100,300,400,700" rel="stylesheet">
        <link rel="shortcut icon" href="images/favicon.ico">

        <!-- HTML5 shim, for IE6-8 support of HTML5 elements. All other JS at the end of file. -->
        <!--[if lt IE 9]>
          <script src="{% static 'js/html5shiv.js' %}"></script>
          <script src="{% static 'js/respond.min.js' %}"></script>
        <![endif]-->

    </head>
    <body>


        <div id="page" class="page">

          <header class="header2" id="header2">

                <nav role="navigation" class="navbar navbar-default">
                    <div class="container">
                    <div class="navbar-header">
                        <button data-target="#navbar-collapse-02" data-toggle="collapse" class="navbar-toggle" type="button">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a href="#" class="navbar-brand brand"><i class="fa fa-codepen"></i>DrinkMachine</a>
                    </div>

                    <div id="navbar-collapse-02" class="collapse navbar-collapse">
                        <ul class="nav navbar-nav">
                            <li class="active"><a href="#">Home</a></li>
                            <li><a href="#">Shots</a></li>
                            <li><a href="#">Search</a></li>
<!--                             <li><a href="#">Blog</a></li>
                            <li><a href="#">Contact</a></li> -->
                        </ul>
                        <ul class="nav navbar-nav navbar-right">
                            <li>
                                <a class="nav-button" href="#">Admin</a>
                            </li>
                        </ul>
                    </div><!-- /.navbar-collapse -->
                    </div>
                </nav>

            </header><!-- header -->
            <section id="content-section7" class="content-section7">
                <div id="root"></div>
            </section>



          </div><!-- /#page -->

          <!-- Modal -->
          <div class="modal fade" id="drink_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  Introduce here the size of every ingredient
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                  <button type="button" class="btn btn-primary">Make Drink</button>
                </div>
              </div>
            </div>
          </div>


        <!--=== Load JS here for greater good ====-->
        <script src="{% static 'js/jquery-1.8.3.min.js' %}"></script>
        <script src="{% static 'js/bootstrap.min.js' %}"></script>
        <script src="{% static 'js/isotope.pkgd.js' %}"></script>
        <script src="{% static 'js/jquery.countdown.min.js' %}"></script>
        <script src="{% static 'js/jquery.flexslider.js' %}"></script>
        <script src="{% static 'js/jquery.nivo.slider.pack.js' %}"></script>
        <script src="{% static 'js/portfolio-custom1.js' %}"></script>
        <script src="{% static 'js/portfolio-custom2.js' %}"></script>
        <script src="{% static 'js/main.js' %}"></script>

        <!-- SuperAgent -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/superagent/3.8.3/superagent.js"></script>

        <!-- React -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react-dom.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.21.1/babel.min.js"></script>
        <script type="text/babel">
            class Drink extends React.Component {

              handleClick() {
                // Show modal dialog
                $("#drink_modal").modal();
              }

              render() {

                var imgStyle = {
                  zIndex: "2",
                  position: "relative",
                  width: "100%"
                };

                return (
                  <div className="col-md-4">
                      <div className="text-center single-content" onClick={this.handleClick}>
                            <img className="img-thumbnail" src={this.props.image} style={imgStyle}/>
                            <h3>{this.props.name}</h3>
                            <p>{this.props.description}</p>
                        </div>
                  </div>
                )

              }
            }

            class DrinkMatrix extends React.Component {

              constructor(props){
                super(props)
                this.description = "Description for drink probant an malis deserunt " +
                                   "commodo labore labore do pariatur, concursionibus singulis " +
                                   "multos consequat. Nostrud anim eiusmod, ita aliqua fabulas."

                // Default item list
                this.item_list_size = 6
                this.item_list = []
                for(var i = 0; i < this.item_list_size; i++)
                  this.item_list.push(<Drink icon="fa fa-spinner fa-spin"/>)

              }

              componentDidMount() {
                superagent
                  .get('/combiner/drink/?count=' + this.item_list_size)
                  .send({ name: 'Manny', species: 'cat' })
                  .set('X-API-Key', 'foobar')
                  .set('Accept', 'application/json')
                  .then((res) => {
                     //console.log(JSON.stringify(res.body))
                     this.item_list = []
                     res.body.forEach( (item, index) => {
                        this.item_list.push(<Drink name={item.name} image={item.image} description={item.description}/>)
                     });

                     // Force render() to be called
                     this.forceUpdate()

                  });

              }

              render() {
                return (
                  <div className="container">
                    <div className="row">
                      {this.item_list[0]}
                      {this.item_list[1]}
                      {this.item_list[2]}
                    </div>
                    <div className="row">
                      {this.item_list[3]}
                      {this.item_list[4]}
                      {this.item_list[5]}
                    </div>
                  </div>
                )
              }
            }


            // Render Items
            ReactDOM.render( <DrinkMatrix />, document.getElementById('root'));
        </script>


        <!-- MQTT -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
        <script type="text/javascript">
        /*
            $( document ).ready(() => {
                var mosquitto_host = "localhost"
                var mosquitto_port = 9001

                var pump_controller_id = 1
                var pump_id = 1
                var pumpclient_topic = "pumpclient/1/1"

                // Create a client instance
                client = new Paho.MQTT.Client(mosquitto_host, mosquitto_port, "clientId");

                // set callback handlers
                client.onConnectionLost = onConnectionLost;
                client.onMessageArrived = onMessageArrived;

                // connect the client
                client.connect({onSuccess:onConnect});


                // called when the client connects
                function onConnect() {

                  var message = {}
                  message["id"] =  Math.floor( (Math.random() * 10000) )
                  message["time_count"] = 5
                  message["sender"] = pumpclient_topic

                  // Once a connection has been made, make a subscription and send a message.
                  console.log("onConnect");
                  client.subscribe(pumpclient_topic);
                  //message = new Paho.MQTT.Message("pumpdata");
                  message = new Paho.MQTT.Message(JSON.stringify(message));
                  message.destinationName = "pumpcontroller/" + pump_controller_id + "/" + pump_id;
                  client.send(message);
                }

                // called when the client loses its connection
                function onConnectionLost(responseObject) {
                  if (responseObject.errorCode !== 0) {
                    console.log("onConnectionLost:"+responseObject.errorMessage);
                  }
                }

                // called when a message arrives
                function onMessageArrived(message) {
                  console.log("onMessageArrived:"+message.payloadString);
                  alert("onMessageArrived:"+message.payloadString)
                }

            });
            /**/
        </script>


</body>
</html>
